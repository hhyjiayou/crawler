/*! operationmaintenancesystem - v1.0.0 - 2015-11-06 */"use strict";var ResourceManageApp=angular.module("ResourceManageApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","commonModule"]);ResourceManageApp.config(function($routeProvider){$routeProvider.when("/resource_management/redis_cluster",{templateUrl:"/views/resource_man/commit.html",controller:"redisClusterController"}).when("/resource_management/redis_router/:search",{templateUrl:"/views/resource_man/redis_router.html",controller:"redisRouterController"}).when("/resource_management/redis_machine/:search",{templateUrl:"/views/resource_man/redis_machine.html",controller:"redisMachineController"}).when("/resource_management/mysql_cluster",{templateUrl:"/views/resource_man/mysql_cluster.html",controller:"mysqlClusterController"}).when("/resource_management/mysql_router/:search",{templateUrl:"/views/resource_man/mysql_router.html",controller:"mysqlRouterController"}).when("/resource_management/mysql_machine/:search",{templateUrl:"/views/resource_man/mysql_machine.html",controller:"mysqlMachineController"}).otherwise({redirectTo:"/resource_management/redis_cluster"})}),ResourceManageApp.controller("resourceManageController",["$scope","navData",function($scope,navData){navData.nav[0].isActive=!0}]),ResourceManageApp.controller("leftNav",["$scope","redisClusterNav",function($scope,redisClusterNav){$scope.navs=redisClusterNav,$scope.changeClass=redisClusterNav.changeClass.bind(this,$scope.navs.nav)}]),ResourceManageApp.controller("redisClusterController",["$scope","errData","Util","redisClusterNav","requestConfig","commonData",function($scope,errData,Util,redisClusterNav,requestConfig,commonData){$scope.configs=requestConfig.redisCluster,$scope.showPage=commonData.showPages,$scope.$watch("showPage",function(){$scope.redisClusterData?($scope.redisClusterPage=Util.array($scope.redisClusterData.data,parseInt($scope.showPage)),$scope.curPage=1):Util.query($scope.configs.redisClusterConfig).then(function(response){$scope.redisClusterData=response.data,$scope.redisClusterPage=Util.array($scope.redisClusterData.data,$scope.showPage),redisClusterNav.changeClass(redisClusterNav.nav,redisClusterNav.nav[0].list[0])})}),$scope.redisClusterTable={title:"Redis集群列表",thead:[{name:"集群",style:"td_manager_name"},{name:"master/路由版本",style:"td_master"},{name:"机器数",style:"td_machine"},{name:"redis实例",style:"td_redis"},{name:"App数",style:"td_apps"},{name:"操作",style:"td_tool"}]},$scope.refreshMsg={text:"",style:""},$scope.queryRedisCluster=function(manager_id,clusterD){$scope.configs.redisClusterConfig.params={managerId:manager_id},Util.query($scope.configs.redisClusterConfig).then(function(response){clusterD=response.data.data[0],$scope.refreshMsg=errData.button.refreshSuccess},function(error){$scope.refreshMsg=errData.button.refreshFail}),clusterD.showDialog=!1,clusterD.refreshMsg=!0},$scope.redisClusterApp={title:"App列表信息",thead:["AppId","AppName"],showMe:!1},$scope.errData=errData,$scope.queryAppId=function(managerId,dialog){dialog.showDialog||($scope.configs.redisAppConfig.params={managerId:managerId},Util.query($scope.configs.redisAppConfig).then(function(response){$scope.redisClusterApp.AppList=response.data}),$scope.showDialog(dialog))},$scope.hideRefresh=function(clusterD){clusterD.refreshMsg=!1},$scope.showDialog=function(dialog){dialog.showDialog=!0},$scope.hideDialog=function(dialog){dialog.showDialog=!1},$scope.curPage=1}]),ResourceManageApp.controller("redisRouterController",["$scope","errData","Util","$routeParams","stateMap","requestConfig","commonData",function($scope,errData,Util,$routeParams,stateMap,requestConfig,commonData){$scope.configs={redisRouterConfig:requestConfig.redisRouter},$scope.showPage=commonData.showPages,$scope.routerParams=$routeParams.search.split(" "),$scope.redisRouterSearch={redisCluster:null,redisStatus:[{statusId:1,statusName:"正常"},{statusId:2,statusName:"空闲"},{statusId:3,statusName:"异常"},{statusId:4,statusName:"迁移"}],searchKey:{managerId:parseInt($scope.routerParams[0]),appId:0==$scope.routerParams[1]?"":$scope.routerParams[1],status:parseInt($scope.routerParams[2])}},$scope.redisRouterList={title:"Redis路由列表",thead:[{name:"App",style:"td_redisRouterAppName"},{name:"Range",style:"td_redisRouterrange"},{name:"集群",style:"td_redisRoutermanagername"},{name:"redis实例",style:"td_redisRoutershili"}]},$scope.$watch("redisRouterSearch.searchKey",function(){$scope.changeClass($scope.navs.nav[0].list[1]),$scope.configs.redisRouterConfig.params={managerId:$scope.redisRouterSearch.searchKey.managerId||0,appId:$scope.redisRouterSearch.searchKey.appId||0,status:$scope.redisRouterSearch.searchKey.status||0},Util.query($scope.configs.redisRouterConfig).then(function(response){$scope.redisRouterSearch.redisCluster=response.data.data.redis_cluster_list,$scope.redisRouterList.List=response.data.data.redis_cluster_details,$scope.redisRouterListPage=Util.array($scope.redisRouterList.List,parseInt($scope.showPage)),$scope.curPage=1})},!0),$scope.$watch("showPage",function(){$scope.redisRouterList.List&&($scope.redisRouterListPage=Util.array($scope.redisRouterList.List,parseInt($scope.showPage)),$scope.curPage=1)}),$scope.stateMap=stateMap,$scope.showTips=commonData.methods.showTips.bind(this),$scope.hideTips=commonData.methods.hideTips.bind(this)}]),ResourceManageApp.controller("redisMachineController",["$scope","errData","Util","$routeParams","stateMap","requestConfig","commonData",function($scope,errData,Util,$routeParams,stateMap,requestConfig,commonData){$scope.configs={redisMachineConfig:requestConfig.redisMachine},$scope.showPage=commonData.showPages,$scope.machineParams=$routeParams.search.split(" "),$scope.redisMachineSearch={redisCluster:null,searchKey:{managerId:parseInt($scope.machineParams[0])||0,ip:0==$scope.machineParams[1]?"":$scope.machineParams[1]}},$scope.redisMachineList={title:"Redis机器列表",thead:[{name:"集群",style:"td_seventeen"},{name:"Redis机器",style:"td_twentytwo"},{name:"Redis实例数",style:"td_Twelve"},{name:"Redis实例",style:"td_fiftyone"}],redisInstantiation:[{name:"编号",style:"td_Fifteen"},{name:"端口",style:"td_seventeen"},{name:"大小",style:"td_seventeen"},{name:"状态",style:"td_seventeen"},{name:"APPID",style:"td_seventeen"},{name:"Range",style:"td_seventeen"}]},$scope.$watch("redisMachineSearch.searchKey",function(){$scope.changeClass($scope.navs.nav[0].list[2]),$scope.configs.redisMachineConfig.params={managerId:$scope.redisMachineSearch.searchKey.managerId||0,ip:$scope.redisMachineSearch.searchKey.ip||0},Util.query($scope.configs.redisMachineConfig).then(function(response){$scope.redisMachineSearch.redisCluster=response.data.data.redis_cluster_list,$scope.redisMachineList.List=response.data.data.redis_machine_details,$scope.redisMachineListPage=Util.array($scope.redisMachineList.List,parseInt($scope.showPage)),$scope.curPage=1})},!0),$scope.$watch("showPage",function(){$scope.redisMachineList.List&&($scope.redisMachineListPage=Util.array($scope.redisMachineList.List,parseInt($scope.showPage)),$scope.curPage=1)}),$scope.stateMap=stateMap,$scope.showTips=commonData.methods.showTips.bind(this),$scope.hideTips=commonData.methods.hideTips.bind(this)}]),ResourceManageApp.controller("mysqlClusterController",["$scope","errData","Util","redisClusterNav","requestConfig","commonData",function($scope,errData,Util,redisClusterNav,requestConfig,commonData){$scope.configs=requestConfig.MySQLCluster,$scope.showPage=commonData.showPages,$scope.$watch("showPage",function(){$scope.changeClass($scope.navs.nav[1].list[0]),$scope.mysqlClusterData?($scope.mysqlClusterPage=Util.array($scope.mysqlClusterData.data,parseInt($scope.showPage)),$scope.curPage=1):Util.query($scope.configs.MySQLClusterConfig).then(function(response){$scope.mysqlClusterData=response.data,$scope.mysqlClusterData.data.forEach(function(item){item.showDialog=!1,item.refreshMsg=!1}),$scope.mysqlClusterPage=Util.array($scope.mysqlClusterData.data,$scope.showPage)})}),$scope.mysqlClusterTable={title:"MySQL集群列表",thead:[{name:"集群",style:"td_manager_name"},{name:"master/路由版本",style:"td_master"},{name:"机器数",style:"td_machine"},{name:"App数",style:"td_apps"},{name:"操作",style:"td_tool"}]},$scope.refreshMsg={text:"",style:""},$scope.queryMySQLCluster=function(manager_id,clusterD){$scope.configs.MySQLClusterConfig.params={managerId:manager_id},Util.query($scope.configs.MySQLClusterConfig).then(function(response){clusterD=response.data.data[0],$scope.refreshMsg=errData.button.refreshSuccess},function(error){$scope.refreshMsg=errData.button.refreshFail}),clusterD.showDialog=!1,clusterD.refreshMsg=!0},$scope.mysqlClusterApp={title:"App列表信息",thead:["AppId","AppName"],showMe:!1},$scope.errData=errData,$scope.queryAppId=function(managerId,dialog){dialog.showDialog||($scope.configs.MySQLAppConfig.params={managerId:managerId},Util.query($scope.configs.MySQLAppConfig).then(function(response){$scope.mysqlClusterApp.AppList=response.data}),$scope.showDialog(dialog))},$scope.hideRefresh=function(clusterD){clusterD.refreshMsg=!1},$scope.showDialog=function(dialog){dialog.showDialog=!0},$scope.hideDialog=function(dialog){dialog.showDialog=!1},$scope.curPage=1}]),ResourceManageApp.controller("mysqlRouterController",["$scope","errData","Util","$routeParams","stateMap","requestConfig","commonData",function($scope,errData,Util,$routeParams,stateMap,requestConfig,commonData){$scope.configs={mysqlRouterConfig:requestConfig.MySQLRouter},$scope.showPage=commonData.showPages,$scope.routerParams=$routeParams.search.split(" "),$scope.mysqlRouterSearch={mysqlCluster:null,searchKey:{managerId:parseInt($scope.routerParams[0]),appId:0==$scope.routerParams[1]?"":$scope.routerParams[1]}},$scope.mysqlRouterList={title:"MySQL路由列表",thead:[{name:"App",style:"td_redisRouterAppName"},{name:"Range",style:"td_redisRouterrange"},{name:"集群",style:"td_redisRoutermanagername"},{name:"MySQL机器",style:"td_redisRoutershili"}]},$scope.$watch("mysqlRouterSearch.searchKey",function(){$scope.changeClass($scope.navs.nav[1].list[1]),$scope.configs.mysqlRouterConfig.params={managerId:$scope.mysqlRouterSearch.searchKey.managerId||0,appId:$scope.mysqlRouterSearch.searchKey.appId||0},Util.query($scope.configs.mysqlRouterConfig).then(function(response){$scope.mysqlRouterSearch.mysqlCluster=response.data.data.mysql_cluster_list,$scope.mysqlRouterList.List=response.data.data.mysql_cluster_details,$scope.mysqlRouterListPage=Util.array($scope.mysqlRouterList.List,parseInt($scope.showPage)),$scope.curPage=1})},!0),$scope.$watch("showPage",function(){$scope.mysqlRouterList.List&&($scope.mysqlRouterListPage=Util.array($scope.mysqlRouterList.List,parseInt($scope.showPage)),$scope.curPage=1)}),$scope.stateMap=stateMap,$scope.showTips=commonData.methods.showTips.bind(this),$scope.hideTips=commonData.methods.hideTips.bind(this)}]),ResourceManageApp.controller("mysqlMachineController",["$scope","errData","Util","$routeParams","stateMap","requestConfig","commonData",function($scope,errData,Util,$routeParams,stateMap,requestConfig,commonData){$scope.configs={mysqlMachineConfig:requestConfig.MySQLMachine},$scope.showPage=commonData.showPages,$scope.machineParams=$routeParams.search.split(" "),$scope.mysqlMachineSearch={mysqlCluster:null,searchKey:{managerId:parseInt($scope.machineParams[0])||0,ip:0==$scope.machineParams[1]?"":$scope.machineParams[1]}},$scope.mysqlMachineList={title:"MySQL机器列表",thead:[{name:"集群",style:"td_twentyfive"},{name:"MySQL机器",style:"td_twentyfive"},{name:"APP个数",style:"td_ten"},{name:"路由信息",style:"td_redisRoutershili"}],mysqlInstantiation:[{name:"编号",style:"td_Thirtythree"},{name:"APPID",style:"td_Thirtythree"},{name:"Range",style:"td_Thirtythree"}]},$scope.$watch("mysqlMachineSearch.searchKey",function(){$scope.changeClass($scope.navs.nav[1].list[2]),$scope.configs.mysqlMachineConfig.params={managerId:$scope.mysqlMachineSearch.searchKey.managerId||0,ip:$scope.mysqlMachineSearch.searchKey.ip||0},Util.query($scope.configs.mysqlMachineConfig).then(function(response){$scope.mysqlMachineSearch.mysqlCluster=response.data.data.mysql_cluster_list,$scope.mysqlMachineList.List=response.data.data.mysql_machine_details,$scope.mysqlMachineListPage=Util.array($scope.mysqlMachineList.List,parseInt($scope.showPage)),$scope.curPage=1})},!0),$scope.$watch("showPage",function(){$scope.mysqlMachineList.List&&($scope.mysqlMachineListPage=Util.array($scope.mysqlMachineList.List,parseInt($scope.showPage)),$scope.curPage=1)}),$scope.stateMap=stateMap,$scope.showTips=commonData.methods.showTips.bind(this),$scope.hideTips=commonData.methods.hideTips.bind(this)}]);